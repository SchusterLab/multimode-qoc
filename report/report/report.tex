\documentclass[letterpaper, 12pt]{article}

\input{/home/tcpropson/repos/multimode-qoc/report/report/preamble}

\begin{document}

\begin{center}
  {\huge Schuster Lab - Multimode QOC Report} \\[0.5em]
  {\large Thomas Propson $\vert$ \href{mailto:tcpropson@uchicago.edu}
    {tcpropson@uchicago.edu} \\[0.5em] \today}
\end{center}

\section{Binomial Code}
\subsection{System Hamiltonian}
The true system hamiltonian according to Vatsan is:
\[
H_{0} = \omega_{c} a^{\dagger} a \otimes I_{b}+ \omega_{t} I_{a} \otimes b^{\dagger} b +
\frac{\alpha}{2} I_{a} \otimes (b^{\dagger} b)^{2} + g (a^{\dagger} + a) \otimes (b^{\dagger} + b)
\]


Our setup is similar to the one in \cite{sun2014tracking}.
Their drift hamiltonian is an approximation of the one above.
It is given by:
\begin{align*}
  H_{0} &= \omega_{c}a^{\dagger}a \otimes I_{b} + \frac{\kappa}{2}(a^{\dagger})^{2}a^{2} \otimes I_{b}\\
  &\quad + \omega_{t} I_{a} \otimes b^{\dagger}b + \frac{\alpha}{2} I_{a} \otimes (b^{\dagger})^{2}b^{2} \\
  &\quad + \chi a^{\dagger}a \otimes b^{\dagger}b + \frac{\chi^{'}}{2}b^{\dagger}b \otimes (a^{\dagger})^{2}a^{2}
\end{align*}
We would like to apply rotating frame transformations to the hamiltonian to make optimization easier. For instance, if the qubit frequency is included in the system hamiltonian we have a term that changes on the order of $\sim$ 5Ghz. However, our wave generators may only be able to generate a pulse with fidelity $\frac{1}{1 Ghz} = 1 ns > \frac{1}{5 Ghz} = 0.2 ns$.

Note that the Hamiltonian is diagonal. If we apply the rotating frame
transformation $U_{rf0} = e^{iH_{0}t}$ following the method shown on page 28 of \cite{krantz2019quantum}, the diagonal matrices will commute and give $\tilde{H_{0}} = 0$. Another interesting transformation that we may apply is $U_{rf1} = e^{iw_{c}a^{\dagger}at} \otimes e^{iw_{t}b^{\dagger}bt}$. Similarly, Vatsan expects a better speedup over the previous transformation by using $U_{rf2} = e^{iw_{t}a^{\dagger}at} \otimes e^{iw_{t}b^{\dagger}bt}$. Applying the first transformation to $H_{0}$ using the rotating frame transformation (equation 82 in \cite{krantz2019quantum}) yields:
\begin{align*}
  \tilde{H_{0}}
  &= i\dot{U}_{rf1}U_{rf1}^{\dagger} + U_{rf1}H_{0}U_{rf1}^{\dagger}\\
  &= i({\partial_{t}}(e^{i\omega_{c}a^{\dagger}at} \otimes e^{i\omega_{t}b^{\dagger}bt}))U_{rf1}^{\dagger} + H_{0}.\\
  &= (i(e^{i\omega_{c}a^{\dagger}at} \otimes {\partial_{t}}e^{i\omega_{t}b^{\dagger}bt})\\
  &+ i({\partial_{t}}e^{i\omega_{c}a^{\dagger}at} \otimes e^{i\omega_{t}b^{\dagger}bt}))U_{rf1}^{\dagger} + H_{0}\\
  &= (i(e^{i\omega_{c}a^{\dagger}at} \otimes i\omega_{t}b^{\dagger}be^{i\omega_{t}b^{\dagger}bt})\\
  &+ i(i\omega_{c}a^{\dagger}ae^{i\omega_{c}a^{\dagger}at} \otimes e^{i\omega_{t}b^{\dagger}bt}))U_{rf1}^{\dagger} + H_{0}\\
  &= (-\omega_{c}a^{\dagger}a - \omega_{t}b^{\dagger}b)(e^{i\omega_{c}a^{\dagger}at} \otimes e^{i\omega_{t}b^{\dagger}bt})U_{rf1}^{\dagger} + H_{0}\\
  &= (-\omega_{c}a^{\dagger}a - \omega_{t}b^{\dagger}b)U_{rf1}U_{rf1}^{\dagger} + H_{0}\\
  &= -\omega_{c}a^{\dagger}a - \omega_{t}b^{\dagger}b + H_{0}\\
  &=\frac{\kappa}{2}(a^{\dagger})^{2}a^{2} \otimes I_{b}\\
  &+ \frac{\alpha}{2} I_{a} \otimes (b^{\dagger})^{2}b^{2} \\
  &+ \chi a^{\dagger}a \otimes b^{\dagger}b\\
  &+ \frac{\chi^{'}}{2}b^{\dagger}b \otimes (a^{\dagger})^{2}a^{2}
\end{align*}
Note that $a^{\dagger}a$ and $b^{\dagger}b$ are diagonal so we may use
$e^{(a_{i,j})} = (e^{a_{i,j}})$. Therefore the transformation $U_{rf1}$ is diagonal.
$H_{0}$ is diagonal so $U_{rf}H_{0}U_{rf}^{\dagger} = H_{0}$

Their drive hamiltonian is given by:
\begin{align*}
H_{d} &= (\epsilon_{c}(t)a + \epsilon^{*}_{c}(t)a^{\dagger}) \otimes I_{b}
+ I_{a} \otimes (\epsilon_{t}(t)b + \epsilon^{*}_{t}(t)b^{\dagger}) \\
\textrm{Taking $\epsilon$ complex with $\epsilon = \epsilon_{x} + i\epsilon_{y}$,} \\
&= ((\epsilon_{c_{x}}(t) + i\epsilon_{c_{y}}(t))a \\
   &\quad + (\epsilon_{c_{x}}(t) - i\epsilon_{c_{y}}(t))a^{\dagger}) \otimes I_{b} \\
   + I_{a} \otimes &((\epsilon_{t_{x}}(t) + i\epsilon_{t_{y}}(t))b \\
   &\quad + (\epsilon_{t_{x}}(t) - i\epsilon_{t_{y}}(t))b^{\dagger})) \\
   &= \epsilon_{c_{x}}(t)(a + a^{\dagger}) \otimes I_{b} \\
   &+ \epsilon_{c_{y}}(t)i(a - a^{\dagger}) \otimes I_{b} \\
   &+ I_{a} \otimes \epsilon_{t_{x}}(t)(b + b^{\dagger}) \\
   &+ I_{a} \otimes \epsilon_{t_{y}}(t)i(b - b^{\dagger})
\end{align*}
We call $(a + a^{\dagger})$ the X drive and $i(a - a^{\dagger})$ the Y drive.
We can see the effect of applying $U_{rf1}$ to the drive hamiltonian by considering its effect on $a \otimes I_{b}$ and $a^{\dagger} \otimes I_{b}$ respectively. The case is symmetric for $I_{a} \otimes b$ and $I_{a} \otimes b^{\dagger}$.
We have:
\begin{align*}
  U_{rf1}(a \otimes I_{b})U_{rf1}^{\dagger}\\
  &= (e^{iw_{c}a^{\dagger}at} \otimes e^{iw_{t}b^{\dagger}bt})(a \otimes I_{b})(e^{-iw_{c}a^{\dagger}at} \otimes e^{-iw_{t}b^{\dagger}bt}) \\
  &= (e^{iw_{c}a^{\dagger}at}ae^{-iw_{c}a^{\dagger}at}) \otimes (e^{iw_{t}b^{\dagger}bt}I_{b}e^{-iw_{t}b^{\dagger}bt})\\
  &=\left[{\begin{array}{ccc}
        1 & 0           & 0 \\
        0 & e^{i\omega_{c}t} & 0 \\
        0 & 0           & e^{i2\omega_{c}t}\\
    \end{array}} \right]
  \left[{\begin{array}{ccc}
      0 & 1 & 0 \\
      0 & 0 & \sqrt{2} \\
      0 & 0 & 0 \\
      \end{array}}\right]
  \left[{\begin{array}{ccc}
        1 & 0            & 0 \\
        0 & e^{-i\omega_{c}t} & 0\\
        0 & 0            & e^{-i2\omega_{c}t}\\
    \end{array}}\right]
  \otimes I_{b} \\
  &=\left[{\begin{array}{ccc}
        0 & 1 & 0 \\
        0 & 0 & \sqrt{2}e^{iw_{c}t} \\
        0 & 0 & 0\\
    \end{array}} \right]
  \left[{\begin{array}{ccc}
        1 & 0           & 0 \\
        0 & e^{-i\omega_{c}t} & 0 \\
        0 & 0           & e^{-i2\omega_{c}t}\\
    \end{array}} \right]
  \otimes I_{b}\\
    &=\left[{\begin{array}{ccc}
        0 & e^{-i\omega_{c}t} & 0 \\
        0 & 0            & \sqrt{2}e^{-i\omega_{c}t} \\
        0 & 0            & 0\\
    \end{array}} \right]
  \otimes I_{b}\\
  &= ae^{-i\omega_{c}t} \otimes I_{b}\\
\end{align*}
Note also $I_{b}$ is diagonal so $U_{rf1} I_{b} U_{rf1}^{\dagger} = I_{b}$.
Without loss of generality we truncate the space $a$ to 3 levels.
Similarly,
\begin{align*}
    U_{rf1}(a^{\dagger} \otimes I_{b})U_{rf1}^{\dagger}\\
  &= (e^{iw_{c}a^{\dagger}at} \otimes e^{iw_{t}b^{\dagger}bt})(a^{\dagger} \otimes I_{b})(e^{-iw_{c}a^{\dagger}at} \otimes e^{-iw_{t}b^{\dagger}bt}) \\
  &= (e^{iw_{c}a^{\dagger}at}a^{\dagger}e^{-iw_{c}a^{\dagger}at}) \otimes (e^{iw_{t}b^{\dagger}bt}I_{b}e^{-iw_{t}b^{\dagger}bt})\\
  &=\left[{\begin{array}{ccc}
        1 & 0           & 0 \\
        0 & e^{i\omega_{c}t} & 0 \\
        0 & 0           & e^{i2\omega_{c}t}\\
    \end{array}} \right]
  \left[{\begin{array}{ccc}
      0 & 0        & 0 \\
      1 & 0        & 0 \\
      0 & \sqrt{2} & 0 \\
      \end{array}}\right]
  \left[{\begin{array}{ccc}
        1 & 0            & 0 \\
        0 & e^{-i\omega_{c}t} & 0\\
        0 & 0            & e^{-i2\omega_{c}t}\\
    \end{array}}\right]
  \otimes I_{b} \\
  &=\left[{\begin{array}{ccc}
        0 &                0          & 0 \\
        e^{i\omega_{c}t} & 0          & 0 \\
        0 & \sqrt{2}e^{i2\omega_{c}t} & 0\\
    \end{array}} \right]
  \left[{\begin{array}{ccc}
        1 & 0           & 0 \\
        0 & e^{-i\omega_{c}t} & 0 \\
        0 & 0           & e^{-i2\omega_{c}t}\\
    \end{array}} \right]
  \otimes I_{b}\\
    &=\left[{\begin{array}{ccc}
        0                & 0                        & 0\\
        e^{i\omega_{c}t} & 0                        & 0\\
        0                & \sqrt{2}e^{i\omega_{c}t} & 0\\
    \end{array}} \right]
  \otimes I_{b}\\
  &= a^{\dagger}e^{i\omega_{c}t} \otimes I_{b}\\
\end{align*}

Note that we can still use time-independent control hamiltonians in optimal control: $X = (a + a_{\dagger})$ and $Y = i(a - a_{\dagger})$. This is important because our optimal control implementation does not support time-dependent hamiltonians currently. The pulse that we want to realize in the experiment is:
\begin{align*}
  \epsilon(t) cos(\omega_{d}t)(a + a^{\dagger})\\
  &= \epsilon(t) cos(\omega_{c}t + \phi(t))(ae^{-i\omega_{c}t} + a^{\dagger}e^{i\omega_{c}t})\\
  &= \frac{1}{2}\epsilon(t)(e^{i(\omega_{c} + \phi(t))} + e^{-i(\omega_{c} + \phi(t))})(ae^{-i\omega_{c}t} + a^{\dagger}e^{i\omega_{c}t})\\
  &= \frac{1}{2}\epsilon(t)(ae^{i\phi(t)} + a^{\dagger}e^{-i\phi(t)})\\
  &= \frac{1}{2}\epsilon(t)(cos(\phi(t))(a + a^{\dagger}) + sin(\phi(t))i(a - a^{\dagger}))\\
\end{align*}
Optimal control will give us $X = \frac{1}{2}\epsilon(t)cos(\phi(t))(a + a^{\dagger})$ and $Y = \frac{1}{2}\epsilon(t)sin(\phi(t))i(a - a^{\dagger})$. We must then perform the inverse transformation as the one shown here to recover the pulse we should apply in experiment.

\subsection{Error Correction}
Our goal is to transfer state information from the transmon to the cavity while protecting against single photon loss in the cavity. We would like the error correction for single photon loss to be autonomous. We do this by encoding our state information in a binomial code. We have the ground and first excited states of the transmon: $\ket{g}, \ket{e}$. As well as the first five fock states of the cavity: $\ket{0}, \ket{1}, \ket{2}, \ket{3}, \ket{4}$. We choose the computational basis representation for the cavity $\ket{\psi_{\uparrow}} = \frac{1}{\sqrt{2}}(\ket{0} + \ket{4})$ and $\ket{\psi_{\downarrow}} = \ket{2}$.
\begin{enumerate}
\item To encode information from the transmon to the cavity we must drive the transition \\
  \[
  u\ket{g, 0} + v\ket{e, 0} \rightarrow
  u\ket{g, \psi_{\uparrow}} + v\ket{g, \psi_{\downarrow}}
  \]
\item If the state suffers photon loss, we can measure its parity using a ramsey echo experiment. Vatsan knows how to perform this pulse sequence without optimal control. This will have the effect of
  \begin{align*}
    &u\ket{g, 1} + v\ket{g, 3} \rightarrow u\ket{e, 3} + v\ket{e, 1} \\
    &u\ket{g, \psi_{\uparrow}} + v\ket{g, \psi_{\downarrow}} \rightarrow u\ket{g, \psi_{\uparrow}} + v\ket{g, \psi_{\downarrow}}
  \end{align*}

\item Then we must correct the erroneous state by applying a pulse that takes
  \begin{align*}
    &u\ket{e, 1} + v\ket{e, 3} \rightarrow u\ket{e, \psi_{\downarrow}} + v\ket{e, \psi_{\uparrow}} \\
    &u\ket{g, \psi_{\uparrow}} + v\ket{g, \psi_{\downarrow}} \rightarrow u\ket{g, \psi_{\uparrow}} + v\ket{g, \psi_{\downarrow}}    
  \end{align*}
  And we can dump entropy such that $\ket{e} \rightarrow \ket{g}$ and $\ket{g} \rightarrow \ket{g}$. Note that the relative phase information $u, v$ is maintained and the error is corrected.
\end{enumerate}

\subsection{Experiment 1}
For this experiment I will attempt to optimize a pulse for the first step in the error correction scheme. I wish to optimize a multi-state transfer from $\ket{g, 0} \rightarrow \ket{g, \psi{\uparrow}}$ and $\ket{e, 0} \rightarrow \ket{g, \psi{\downarrow}}$. The drift hamiltonian will be
\begin{align*}
  H_{drift} &= \frac{\kappa}{2} (a^{\dagger})^{2}a^{2} \otimes I_{b}\\
  &+ \frac{\alpha}{2} I_{a} \otimes (b^{\dagger})^{2}b^{2}\\
  &+ \chi_{e} a^{\dagger}a \otimes \ket{e}\bra{e}\\
  &+ \chi_{f} a^{\dagger}a \otimes \ket{f}\bra{f}\\
  &+ \frac{\chi^{'}}{2} (a^{\dagger})^{2}a^{2} \otimes b^{\dagger}b\textrm{.}\\
\end{align*}
Where $\kappa = -2.26* 10^{-6}$GHz, $\alpha = -0.139$GHz, $\chi_{e} = -5.61 * 10^{-4}$GHz, $\chi_{f} = -1.02 * 10^{-3}$GHz and $\chi^{'} = 0$.
The control hamiltonian will be
\begin{align*}
  H_{control} &= \epsilon_{c, x} (a + a^{\dagger}) \otimes I_{b}\\
  &+ \epsilon_{c, y} i(a - a^{\dagger}) \otimes I_{b}\\
  &+ \epsilon_{t, x} I_{a} \otimes (b + b^{\dagger})\\
  &+ \epsilon_{t, y} I_{a} \otimes i(b - b^{\dagger})\\
\end{align*}
Where $max(\epsilon_{c}) = 2\pi * 2 * 10^{-3}$GHz and $max(\epsilon_{t}) = 2\pi * 2 * 10^{-2}$GHz.

The cavity space will be truncated to the first five fock states $\ket{0} ... \ket{4}$. The transmon space will be truncated to the first three levels $\ket{g}, \ket{e}, \ket{f}$. Vatsan recommended choosing a pulse time on the order of a microsecond. Note that the slowest oscillation in our system is $\kappa^{-1} = -4.42 * 10^{5}$ns. Note that the fastest oscillation in our system is $\alpha^{-1} = -7.19$ns. We use a 1 gigasample pulse generator. In light of these constraints, I will choose $\delta t = 5$ns. I will choose a pulse time of $1000$ns. I will run $1000$ iterations per optimization. I will choose a learning rate of $1*10^{-3}$. I will first run without regularization coefficients and forbidden states, then run with them. For regularization coefficients, I will choose $dwdt = steps * 1 * 10^{-3}, dw2dt2 = steps * 1 * 10^{-6}$. I will forbid the state $\psi_{f} = I_{a} \otimes \ket{f}\bra{f}$ with $forbidden = steps * 1 * 10^{-3}$.

I expect that the generated pulse will look like two superimposed pulses, one that performs the first state transfer and one that performs the other.

Experiment 1 converged to an optimization error on the order of $10^{-1}$ with and without regularization coefficients. HPO will be implemented.

\subsection{Experiment 2}
I am going to try decoupling the state transfers described in experiment 1. Perhaps if we can recover good state transfer pulses for each, we may use their combination as an initial guess for a new optimisation. Experiment 2 will proceed exactly as experiment 1, but two seperate optimisations will be performed. Pulse 0 refers to the state transition $\ket{0, g} \rightarrow (\frac{1}{2})^{1/2} (\ket{0, g} + \ket{4, g})$. Pulse 1 refers to the state transition $\ket{0, e} \rightarrow \ket{2, g}$. Pulse 2 refers to the state transition $\ket{0, g} \rightarrow \ket{4, g}$. Pulse 3 refers to the state transition $\ket{0, g} \rightarrow \ket{1, g}$.

\section{Piccolo}
\subsection{System Hamiltonian}
Vatsan told me that the transmon-cavity system hamiltonian is:
\begin{align*}
  H &= \omega_{f}\ket{f}\bra{f} \\
  &+ \omega_{e}\ket{e}\bra{e}\\
  &+ \epsilon_{ge}e^{i\omega_{d}t}\ket{g}\bra{e} + \epsilon_{ge}^{*}e^{-i\omega_{d}t}\ket{e}\bra{g}\\
  &+ \epsilon_{ef}e^{i\omega_{d}t}\ket{e}\bra{f} + \epsilon_{ef}^{*}e^{-i\omega_{d}t}\ket{f}\bra{e}\\
  &+ \omega_{c}a^{\dagger}a\\
  &+ \chi_{e}\ket{e}\bra{e}a^{\dagger}a + \chi_{f}\ket{f}\bra{f}a^{\dagger}a\\
  &+ \epsilon_{sb}e^{i\omega_{d}t}\ket{f}\bra{g}a + \epsilon_{sb}^{*}e^{-i\omega_{d}t}\ket{g}\bra{f}a^{\dagger}\\
  &+ \epsilon_{sb}^{2}(\eta_{e}\ket{e}\bra{e} + \eta_{f}\ket{f}\bra{f})\\
\end{align*}
Here there is an implicit tensor product between the transmon and the cavity space. The control amplitudes $\epsilon$ are implicitly time dependent.

I can think of $\epsilon e^{i\omega_{d}t}$ as a complex number with arbitrarily chosen phase $e^{i\omega_{d}t}$. Therefore I can choose $\epsilon$ to be real. We then do the standard x and y trick to derive the control hamiltonian:
\begin{align*}
  H_{control} &= \epsilon_{ge, x}cos(\omega_{d}t)(\ket{g}\bra{e} + \ket{e}\bra{g})\\
  &+ \epsilon_{ge, y}sin(\omega_{d}t)i(\ket{g}\bra{e} - \ket{e}\bra{g})\\
  &+ \epsilon_{ef, x}cos(\omega_{d}t)(\ket{e}\bra{f} + \ket{f}\bra{e})\\
  &+ \epsilon_{ef, y}sin(\omega_{d}t)i(\ket{e}\bra{f} - \ket{f}\bra{e})\\
  &+ \epsilon_{sb, x}cos(\omega_{d}t)(\ket{f}\bra{g}a + \ket{g}\bra{f}a^{\dagger})\\
  &+ \epsilon_{sb, y}sin(\omega_{d}t)i(\ket{f}\bra{g}a - \ket{g}\bra{f}a^{\dagger})\\
  &+ \epsilon_{sb}^{2}(\eta_{e}\ket{e}\bra{e} + \eta_{f}\ket{f}\bra{f})\\
\end{align*}

We apply the rotating frame transformation $U = exp(i(\omega_{f}\ket{f}\bra{f} + \omega_{e}\ket{e}\bra{e} + \omega_{c}a^{\dagger}a)t)$. Note that the transformation is diagonal so the diagonal terms from the hamiltonian will commute. We can consider the effect of the transformation on each basis of the system. Namely:
\begin{align*}
  \ket{e} &\rightarrow \ket{e}e^{i\omega_{e}t}\\
  \ket{f} &\rightarrow \ket{f}e^{i\omega_{f}t}\\
  a &\rightarrow ae^{-i\omega_{c}t}\\
  a^{\dagger} &\rightarrow a^{\dagger}e^{i\omega_{c}t}\\
\end{align*}
After the transformation the system is now:
\begin{align*}
  H &= \chi_{e}\ket{e}\bra{e}a^{\dagger}a + \chi_{f}\ket{f}\bra{f}a^{\dagger}a\\
  &+ \epsilon_{ge, x}cos((\omega_{d} - \omega_{e})t)(\ket{g}\bra{e} + \ket{e}\bra{g})\\
  &+ \epsilon_{ge, y}sin((\omega_{d} - \omega_{e})t)i(\ket{g}\bra{e} - \ket{e}\bra{g})\\
  &+ \epsilon_{ef, x}cos((\omega_{d} + \omega_{e} - \omega_{f})t)(\ket{e}\bra{f} + \ket{f}\bra{e})\\
  &+ \epsilon_{ef, y}sin((\omega_{d} + \omega_{e} - \omega_{f})t)i(\ket{e}\bra{f} - \ket{f}\bra{e})\\
  &+ \epsilon_{sb, x}cos((\omega_{d} + \omega_{f})t)(\ket{f}\bra{g}a + \ket{g}\bra{f}a^{\dagger})\\
  &+ \epsilon_{sb, y}sin((\omega_{d} + \omega_{f})t)i(\ket{f}\bra{g}a - \ket{g}\bra{f}a^{\dagger})\\
  &+ \epsilon_{sb}^{2}(\eta_{e}\ket{e}\bra{e} + \eta_{f}\ket{f}\bra{f})\\
\end{align*}

\subsection{Mach 1}
In recognition that we would like to have a physically realizable control pulse, I am going to take a stab at running QOC on this hamiltonian. The first experiment I will do is a state transfer from the qubit ground state to the first excited state $\ket{g} \rightarrow \ket{e}$.
The drift hamiltonian will be:
\begin{align*}
  H_{0} = \chi_{e}\ket{e}\bra{e} \otimes a^{\dagger}a + \chi_{f}\ket{f}\bra{f} \otimes a^{\dagger}a\\
\end{align*}
Where $\chi_{e} = -5.65*10^{-4} GHz$ and $\chi_{f} = 2 \chi_{e}$.
The control hamiltonians will be
\begin{align*}
  H_{ge, x} &= (\ket{g}\bra{e} + \ket{e}\bra{g}) \otimes I_{c}\\
  H_{ge, y} &= i(\ket{g}\bra{e}- \ket{e}\bra{g}) \otimes I_{c}\\
  H_{ef, x} &= (\ket{e}\bra{f} + \ket{f}\bra{e}) \otimes I_{c}\\
  H_{ef, y} &= i(\ket{e}\bra{f} - \ket{f}\bra{e}) \otimes I_{c}\\
  H_{sb, x} &= (\ket{f}\bra{g} \otimes a + \ket{g}\bra{f} \otimes a^{\dagger})\\
  H_{sb, y} &= i(\ket{f}\bra{g} \otimes a - \ket{g}\bra{f} \otimes a^{\dagger})\\
\end{align*}
Where the stark shift term is dropped because the optimal control package cannot encode the term in its current state. I will specify the maximum operator amplitudes to be $2\pi*4*10^{-4}$GHz for $H_{ge}$ and $H_{ef}$; I will specify $2\pi*2*10^{-3}$GHz for $H_{sb}$. I will truncate the space of the cavity to the first five fock states ($\ket{0} ... \ket{4}$) and the space of the transmon to the first three states ($\ket{g}, \ket{e}, \ket{f}$). The state concerned in the transfer will be $\ket{0} \otimes \ket{g}$. The target state will be $\ket{0} \otimes \ket{e}$. I will run on CPUs. I will run first without regularization coefficients, then I will run with regularization coefficients. When running with regularization coefficients I will choose $dwdt = steps * 1*10^{-3}$, $dw2dt2 = steps * 1*10^{-6}$. I will run on the time scale $1*10^{3}$ nanoseconds at $1*10^{3}$ steps to achieve a pulse granularity of 1 operation per nanosecond. I will run at 1000 iterations with a learning rate of $0.001$.
I am not sure which pulse will "look better" in the sense of having a physically realizable shape. I expect that the pulse with regularization coefficients will have less amplitude variances over short time scales than the pulse without reg coeffs. However, the reg coeffs pulse could suffer from other cost factors such as high amplitude. E.g. it may not be possible to achieve the desired transformation while obeying the reg coeffs. If I cannot achieve the desired transformation with a reasonable error or fidelity, I will move to a hyperparameter optimization scheme on the optimization learning rate.

\begin{figure}
  %% \includegraphics[width=\linewidth]{data/00000_piccolo_mach1.png}
  \caption{Resulting pulses for piccolo state transfer without regularization coefficients.}
\end{figure}

The results for the pulses without regularization coefficients seems reasonable (Figure 1). It appears that the pulses are similar to a pi-pulse on the transmon. However, it is very clear that the pulse has fast fluctuations in its waveform, i.e. $dA/dt$ is large for some time steps $dt$. In particular, the sideband pulses fluctuate quickly.

\begin{figure}
  %% \includegraphics[width=\linewidth]{data/00001_piccolo_mach1.png}
  \caption{Resulting pulses for piccolo state transfer with regularization coefficients on
    the pulse amplitude derivative and the pulse amplitude second derivative.}
\end{figure}

The second pulse sequence is really cool (Figure 2). It appears that supressing large variations in pulse amplitude mitigate control amplitudes that are effectively doing nothing. E.g. it is likely the case that in the first set of pulses, the non GE pulses have no net effect on the system but fluctuate rapidly to have a negligible effect. Whereas in the second pulse sequence, all non GE pulses are near zero when fluctuations are limited.

\subsection{Mach 2}
I showed Vatsan my results for Mach 1. First, he stated that the problem I was trying to solve wasn't interesting ($\ket{g, 0} \rightarrow \ket{e, 0}$). Instead, he suggested that I try to solve $\ket{g, 0} \rightarrow \ket{g, 1}$ or $\ket{g, 0} \rightarrow \ket{g, 2}$. Further, he told me to update some constants. He told me to switch my maximum amplitude on the pulses $H_{ge}$ and $H_{ef}$ to $MAX\_AMP\_T = 2 * \pi * 2 * 10^{-2}$GHz and that on the pulses $H_{sb}$ to $MAX\_AMP\_SB = 2 * \pi * 2 * 10^{-3}$GHz. He told me to reduce my pulse time to $250$ nanoseconds. I will run state transfer on $\ket{g,0} \rightarrow \ket{g, 1}$ for the Mach 2 experiment. I will keep the same regularization coefficients. In this experiment, I expect to see pulse sequences that correspond roughly to the analytic sequence that achieves the desired state. Namely, $\ket{g, 0} \rightarrow \ket{e, 0} \rightarrow \ket{f, 0} \rightarrow \ket{g, 1}$.

Note that Vatsan told me I can try adding different control hamiltonians. Namely, a drive on the cavity $H_{c} = (a + a^{\dagger})$.

\begin{figure}
  %% \includegraphics[width=\linewidth]{data/00000_piccolo_mach2.png}
  \caption{Resulting pulses for piccolo state transfer $\ket{g, 0} \rightarrow \ket{g, 1}$.}
\end{figure}

The GE and EF drives overlap for the first time step in the pulse. Then, the SB drive pulse sequence rises. This seems to correspond well to a time condensed version of the analytic sequence to achieve the state.

\subsection{HPO}
While running the Mach 2 and Mach 3 experiments, I began to see slow or no convergence. E.g. the optimization would not achieve sub 1 error until iteration 800 or would never achieve sub 1 error. It seems requisite to introduce a hyperparameter optimization scheme. Due to previous success in running HPO on the learning rate, I will implement a system to do so. I propose implementing raytune. 

\subsection{Mach 3}
For the Mach3 experiment, I will do everything in the Mach 2 experiment except the state transfer will be: $\ket{g, 0} \rightarrow \ket{g, 2}$.

\begin{figure}
  %% \includegraphics[width=\linewidth]{data/00000_piccolo_mach3.png}
  \caption{Resulting pulses for piccolo state transfer $\ket{g, 0} \rightarrow \ket{g, 2}$.}
\end{figure}

\subsection{Experiment 1}
Vatsan described that the piccolo is one qubit and one cavity, where the cavity is shaped not perfectly like a box, but like a rotated knife, i.e. it comes to a point at one end. In the case of this cavity $b << L$ so the modes of the cavity are dominanted by increasing frequencies along $L$. The multimode sample is one qubit and many cavities.

8/21/19: Now that GRAPE 2.0 is functional, I will try again to make some interesting pulses for the Piccolo system. Vatsan would like me to make photon loss correcting code pulses for the transmon and multi-cavity system using the piccolo hamiltonian. These first few expermients will be me trying to climb the cavity ladder. In particular, experiment 1 will be the state transfer $\ket{g, 0} \rightarrow \ket{g, 1}$.

The system hamiltonian is
\begin{align*}
  H_{0} = \chi_{e}\ket{e}\bra{e} \otimes a^{\dagger}a + \chi_{f}\ket{f}\bra{f} \otimes a^{\dagger}a\\
\end{align*}
Where $\chi_{e} = -5.65*10^{-4} GHz$ and $\chi_{f} = 2 \chi_{e}$. For the derivation of this hamiltonian, see above.

The control hamiltonians will be
\begin{align*}
  H_{ge} &= \epsilon_{ge} (\ket{g}\bra{e} \otimes I_{c})\\
         &+ \epsilon_{ge}^{*} (\ket{e}\bra{g} \otimes I_{c})\\
  H_{ef} &= \epsilon_{ef} (\ket{e}\bra{f} \otimes I_{c})\\
         &+ \epsilon_{ef}^{*} (\ket{f}\bra{e} \otimes I_{c})\\
  H_{c} &= \epsilon_{c} (I_{t} \otimes a)\\
        &+ \epsilon_{c}^{*} (I_{t} \otimes a^{\dagger})\\
\end{align*}
Where $MAX\_AMP\_T = 2 * \pi * 2 * 10^{-2}$GHz for $\epsilon_{ge}$ and $\epsilon_{ef}$. Similarly, $MAX\_AMP\_C = 2 * \pi * 2 * 10^{-3}$GHz for $\epsilon_{c}$.

\subsection{Experiment 2}
This experiment will have the same setup as experiment 1. The goal of this experiment will be to achieve the state transfer $\ket{g, 0} \rightarrow \ket{g, 2}$.

\subsection{Experiment 3}
This experiment will have the same setup as experiment 1. The goal of this experiment will be to achieve the state transfer $\ket{g, 0} \rightarrow \ket{g, 3}$.

\subsection{Experiment 4}
This experiment will have the same setup as experiment 1. The goal of this experiment will be to achieve the state transfer $\ket{g, 0} \rightarrow \ket{g, 4}$.

\subsection{Experiment 5}
This experiment will have the same setup as experiment 1. The goal of this experiment will be to achieve the state transfer $\ket{g, 0} \rightarrow (\ket{g, 0} + \ket{g, 4}) / \sqrt{2}$.

\subsection{Experiment 6}
This experiment will have the same setup as experiment 1. The goal of this experiment will be to achieve the state transfer $\ket{e, 0} \rightarrow \ket{g, 2}$.

\subsection{Experiment 7}
This experiment will have the same setup as experiment 1. The goal of this experiment will be to achieve the state transfer $\ket{g, 0} \rightarrow \ket{g, 1}$ and $\ket{e, 0} \rightarrow \ket{g, 1}$.

\subsection{Experiment 8}
The system hamiltonian is:
\begin{align*}
  H_{0}
  &= 2 * \chi_{e} * a^{\dagger}a \otimes \ket{e}\bra{e}\\
  %% &+ 2 * \chi_{f} * a^{\dagger}a \otimes \ket{f}\bra{f}\\
  &+ \chi_{e, 2} * {a^{\dagger}}^{2}a^{2} \otimes \ket{e}\bra{e}\\
  &+ \frac{\kappa}{2} * {a^{\dagger}}^{2}a^{2} \otimes I_{t}\\
\end{align*}

The control hamiltonians are:
\begin{align*}
  H_{ge} &= \epsilon_{ge} (I_{c} \otimes \ket{g}\bra{e})\\
         &+ \epsilon_{ge}^{*} (I_{c} \otimes \ket{e}\bra{g})\\
  %% H_{ef} &= \epsilon_{ef} (\ket{e}\bra{f} \otimes I_{c})\\
  %%        &+ \epsilon_{ef}^{*} (\ket{f}\bra{e} \otimes I_{c})\\
  H_{c} &= \epsilon_{c} (a \otimes I_{t})\\
        &+ \epsilon_{c}^{*} (a^{\dagger} \otimes I_{t})\\
\end{align*}

We will use 20 cavity levels and two transmon levels. This is motivated by experimental results; Vatsan has seen that higher cavity modes are being populated, but higher transmon levels are not being populated by optimal control pulses.

\begin{align*}
  \chi_{e} &= -5.65 \cdot 10^{-4} GHz\\
  \chi_{e, 2} &= 7.3 \cdot 10^{-7} GHz\\
  \kappa &= 2.09 \cdot 10^{-6} GHz\\
  MAX\_AMP\_C &= 2 \cdot \pi \cdot 2 \cdot 10^{-3} GHz\\
  MAX\_AMP\_T &= 2 \cdot \pi \cdot 2 \cdot 10^{-2} GHz\\
\end{align*}

Experiment 8 will attempt to achieve the state transfer $\ket{0, g} \rightarrow \ket{1, g}$.

\subsection{Experiment 9}
The system hamiltonian in the rotating frame for the piccolo under blockade is
\begin{align*}
  H &= 2 \cdot \chi \cdot (a^{\dagger}a - n_{0}) \ket{e} \bra{e}\\
  &+ \Omega \cdot (\ket{g} \bra{e} + \ket{e} \bra{g})\\
  &+ \frac{\kappa}{2} \cdot (a^{\dagger}a)(a^{\dagger}a - 1)\\
  &+ \epsilon(t)a + \epsilon(t)^{*}a^{\dagger}
\end{align*}
where
\begin{table}[H]
  \begin{center}
    \begin{tabular}{c | c}
      Parameter & Value\\
      \hline
      $\chi$          & $2 \pi \cdot -5.644535742521878 \cdot 10^{-4}$ GHz\\
      $\kappa$        & $2 \pi \cdot -2.82 \cdot 10^{-6}$ GHz\\
      $\Omega$        & $2 \pi \cdot 1.44 \cdot 10^{-4}$ GHz\\
      $MAX\_BANDWIDTH$ & $2 \cdot \Omega$\\
      $MAX\_AMPLITUDE$ & $2 \pi \cdot 1.5 \cdot 10^{-5}$ GHz\\
    \end{tabular}
  \end{center}
  \caption{Rotating frame hamiltonian parameters for the piccolo blockade.}
\end{table}

Experiment 9 will attempt to achieve the state transfer
\begin{align*}
  \ket{0, g} \rightarrow \ket{1, g}
\end{align*}

\subsection{Experiment 10}
Experiment 10 will follow the blockade setup of experiment 9. It will
attempt the state transfer
\begin{align*}
  \ket{0, g} \rightarrow \ket{1, g}
  \ket{1, g} \rightarrow \ket{2, g}
  \ket{2, g} \rightarrow \ket{0, g}
\end{align*}

\subsection{Experiment 11}
Experiment 11 will attempt to do a state transfer $\ket{0, g} \rightarrow \ket{1, g}$
on the piccolo system with SNAP gates. The system hamiltonian is

\bibliography{/home/tcpropson/repos/multimode-qoc/report/report/bib}
\bibliographystyle{plainnat}

\end{document}
